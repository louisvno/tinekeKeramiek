function getStorageRef(e,t,n){return e.ref().child(t+"/"+n)}function getPostRef(e){var t=e.ref().child(profile.postPath).push().key;return{postId:t,path:e.ref(profile.postPath+"/"+t)}}function storeImages(e,t,n){var r=[];if(t.length>0){for(var o=0;o<t.length;o++)if(t[o].files.length>0){var a=t[o].files[0].name,i=t[o].files[0];r.push(getStorageRef(e,n,a).put(i))}return Promise.all(r)}throw new Error("No files selected")}function sendPost(e,t){var n=getFiles(),r=getPostRef(t);return storeImages(e,n,r.postId).then(function(e){if(isEmptyObj(e))throw new Error("Upload failed");var t=writePostData("user_id",(new Date).toUTCString(),getFormInput(),e);return r.path.set(t)}).then(function(e){return clearForm(),"Upload success!"}).catch(function(e){throw e})}function getFormInput(){return{text:document.getElementById("post-text").value,title:document.getElementById("post-title").value,category:document.getElementById("post-category").value}}function clearForm(){document.getElementById("post-text").value="",document.getElementById("post-title").value="",document.getElementById("post-category").selectedIndex="0";for(var e=getFiles(),t=0;t<e.length;t++)e[t].value=""}function getFiles(){return document.querySelectorAll("input[type=file]")}function writePostData(e,t,n,r){for(var o={},a=(getFiles(),0);a<r.length;a++){var i={name:r[a].metadata.name,publishDate:r[a].metadata.timeCreated,storagePath:r[a].metadata.fullPath,url:r[a].downloadURL};o["img"+a]=i}return{userId:e,publishDate:t,text:n.text||"",title:n.title||"",category:n.category||"",images:o}}function isEmptyObj(e){return Object.keys(e).length<1}function isValidForm(){return formNotEmpty()&&validateFileNames()}function formNotEmpty(){var e=getFormInput();return!(!e.text||!e.title||"default"==e.category)}function validateFileNames(){var e=getFiles();if(e.length>0){for(var t=[],n=!0,r=0;r<e.length;r++){var o=e[r].value.split("\\").pop().toLowerCase();if(o.length>0){if(isDuplicate(o,t)){n=!1;break}t.push(o)}}return n}return!1}function isDuplicate(e,t){return 0!=t.length&&(-1!==t.indexOf(e)&&(t.indexOf(e)>-1||void 0))}var provider=new firebase.auth.GoogleAuthProvider,profile={postPath:"posts"};document.getElementById("send-post").addEventListener("click",function(e){var t=firebase.storage(),n=firebase.database(),r=document.querySelector(".loader"),o=document.getElementById("send-post"),a=document.getElementById("logmsg");e.preventDefault(),isValidForm()&&(a.style.display="none",r.style.display="inline-block",r.classList.add("spin"),o.disabled=!0,sendPost(t,n).then(function(e){r.style.display="none",a.style.color="green",a.innerHTML=e,a.style.display="inline",o.disabled=!1}).catch(function(e){r.style.display="none",a.innerHTML=e.message,a.style.display="inline",a.style.color="red",o.disabled=!1}))}),firebase.auth().signInWithPopup(provider).then(function(e){}).catch(function(e){e.code,e.message,e.email,e.credential});